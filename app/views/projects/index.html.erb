<% content_for :head do %>

    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/fixedcolumns/3.3.2/js/dataTables.fixedColumns.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedcolumns/3.3.2/css/fixedColumns.dataTables.min.css">

    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.dataTables.min.css">


    <link href="https://nightly.datatables.net/searchpanes/css/searchPanes.dataTables.css?_=8054705740aed0c29e3a84ebb221cf01.css" rel="stylesheet" type="text/css" />
    <script src="https://nightly.datatables.net/searchpanes/js/dataTables.searchPanes.js?_=8054705740aed0c29e3a84ebb221cf01"></script>

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://jqueryui.com/resources/demos/style.css">
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
    
  <%= javascript_pack_tag "datatable" %>
<% end %>

<% content_for :title, 'Projects' %>
<div id="loadingOverlay">
  <%=image_tag "loading_icon.gif"%>
</div>
<div class="container">
    <div class="mt-5">
      <h1>
      Projects Information
      <button class = "btn btn-1" style="display:inline" >
        <%= link_to "Database Helper", "tutorial/database/1" %>
      </button>
      </h1>
    </div>
  <div id="db-toolbar">
    <div class="db-tool-nav">
      <%# <div class="btn btn-outline-dark" data-toggle="collapse" data-target="#hidden_helper" aria-expanded="true" aria-controls="hidden_helper"> 
          Filter Columns <i class="fas fa-caret-down"></i>
      </div> %>
      <div class="btn btn-outline-dark" data-toggle="collapse" data-target="#download_box" aria-expanded="true" aria-controls="download_box">
        Download Data <i class="fas fa-caret-down"></i>
      </div>
    </div>
    <%# <div id='hidden_helper'  class="db-toolbox collapse p-2"> %>
      <%# i=2 %>
      <%# @attrs.each do |attr| %>
        <%# if attr != 'id'%>
          <%# if !@vis.include? attr%>
            <%# <button class="toggle-vis btn btn-outline-secondary" data-column='<%=i.to_s%>
              <%#= attr%>
            <%# </button> %>
          <%# end %>
          <%#i += 1%>
        <%#end%>
      <%#end%>
    <%# </div> %>
    <%= form_tag export_selected_projects_path(format: "csv"), multipart: true do %> 
      <div id="download_box" class="db-toolbox collapse" data-parent="#db-toolbar">
        <div class="form-group p-2">
          <%= button_tag :class => "s_table_sub btn btn-theme btn-info download" do %>
            <i class='fas fa-check-circle'></i> Selected projects
          <%end%>
          <%= link_to projects_path(format: "csv"), disabled: true, :class => "s_table_sub btn btn-pink float-right" do %>
            <i class='fas fa-download'></i> All projects
          <%end%>
        </div>
      </div>
    <%end%>
  </div>
  <br/>

  <% (@col_ranges).each do |mr| %>
      <div id=<%="rangeselect_" + String(mr[:n]) %> title="Range Filter" class="rangeselect">
          <p>
              <label for=<%="value_" + String(mr[:n]) %> >Range:</label>
              <input type="text" id=<%="value_" + String(mr[:n]) %> readonly style="border:0; color:#f6931f; font-weight:bold;" class="w-50">
              <button class="btn btn-outline-primary btn-sm" type="button" data-toggle="collapse" data-target=<%="#collapse_" + String(mr[:n]) %> aria-expanded="false" aria-controls="collapseExample">
                  <i class="fas fa-pen-alt" data-toggle="tooltip" data-placement="left" title="Custom range"></i>
              </button>
              <button class="btn btn-outline-warning btn-sm reset-r" type="button" data-toggle="tooltip" data-placement="top" title="Reset this filter" id=<%="reset_" + String(mr[:n]) %> >
                  <i class="far fa-times-circle"></i>
              </button>
              <div class="form-row collapse" id=<%="collapse_" + String(mr[:n]) %> >
                  <div class="form-group col-md-6">
                      <input type="number" class="form-control umin" placeholder="Min" id=<%="umin_" + String(mr[:n]) %> >
                  </div>
                  <div class="form-group col-md-6">
                      <input type="number" class="form-control umax" placeholder="Max" id=<%="umax_" + String(mr[:n]) %> >
                  </div>
              </div>
          </p>

          <div id=<%="slider-range_" + String(mr[:n]) %> class="w-100 slider-range"></div>

          <input type="hidden" value=<%=String(mr[:min]) %> id=<%="min_" + String(mr[:n]) %> >
          <input type="hidden" value=<%=String(mr[:max]) %> id=<%="max_" + String(mr[:n]) %> >
          <br>
      </div>
  <% end %>



   
  <%= content_tag :table, role: :datatable, class: "display", id: "filter_table" do %>
    <p>You can click <span style= "color: #006fff;">project name</span> to view the original link of project.
      You can click <span style= "color: #006fff;">details</span> to view the Sample Details, C1-C6 Subtyping, TIME Estimation.
    </p>
    
    <thead>
          <th>
            <input type="checkbox" class="selectAll" name="selectAll" value="all">
          </th>
          <% @attrs.each_with_index do |attr, idx| %>
            <th>
            <% if @sp_col_index.include?(idx + 1) %>
              <button class='ftitle btn btn-link btn-sm text-decoration-none' id= "t-<%=attr%>"><i class='fas fa-filter'></i> <%=attr%> </button>
            <% else %>
              <div class="ftitle">
                <%=attr%>
              </div>
            <% end %>
            </th>
          <% end %>
          <th>details</th>
    </thead>
    <tbody>
      <% @projects.each do |pj| %>
        <tr>
          <td></td>
          <% @attrs.each do |attr| %>
            <% if attr == "project_name" %>
              <td> <%= link_to("#{pj[attr]}", pj.original_link) %> </td>
            <% elsif attr == "original_description" %>
              <td><div class="table_cell"><%= pj[attr] %></div></td>
            <% else %>
              <td><%= pj[attr] %></td>
            <% end %>
          <% end %>
          <td>
            <button class='btn btn-1'> <%= link_to('Details', pj) %> </button>
          </td>
        </tr>
      <% end %>
    </tbody>
    
  <% end %>


  
</div>
